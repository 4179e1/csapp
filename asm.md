- [寄存器惯例 - 函数调用](#%e5%af%84%e5%ad%98%e5%99%a8%e6%83%af%e4%be%8b---%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8)
  - [栈结构](#%e6%a0%88%e7%bb%93%e6%9e%84)
  - [参数传递](#%e5%8f%82%e6%95%b0%e4%bc%a0%e9%80%92)
  - [返回值](#%e8%bf%94%e5%9b%9e%e5%80%bc)
  - [被调用者保存](#%e8%a2%ab%e8%b0%83%e7%94%a8%e8%80%85%e4%bf%9d%e5%ad%98)
  - [调用者保存](#%e8%b0%83%e7%94%a8%e8%80%85%e4%bf%9d%e5%ad%98)
- [寄存器惯例 - Linux Syscall](#%e5%af%84%e5%ad%98%e5%99%a8%e6%83%af%e4%be%8b---linux-syscall)
  - [系统调用号](#%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8%e5%8f%b7)
  - [参数传递](#%e5%8f%82%e6%95%b0%e4%bc%a0%e9%80%92-1)
  - [返回地址](#%e8%bf%94%e5%9b%9e%e5%9c%b0%e5%9d%80)

## 寄存器惯例 - 函数调用

### 栈结构

| 栈底     |                |
| -------- | -------------- |
| 较早的栈 |                |
| 调用者   | 被保存的寄存器 |
|          | 局部变量       |
|          | 参数n          |
|          | ...            |
|          | 参数7          |
|          | 返回地址       |
| 被调者   | 被保存的寄存器 |
| %rsp     | 局部变量       |
| 栈顶     |                |

### 参数传递

| 参数 | 寄存器 |
| ---- | ------ |
| 1    | %rdi   |
| 2    | %rsi   |
| 3    | %rdx   |
| 4    | %rcx   |
| 5    | %r8    |
| 6    | %r9    |

### 返回值

%rax

### 被调用者保存

如果当前函数需要修改这些寄存器的值，需要先保存到栈中，用完后还原

- %rbx
- %rbp
- %r12
- %r13
- %r14
- %r15

### 调用者保存

- %rax
- %rcx
- %rdx
- %rdi
- %rsi
- %r8
- %r9

## 寄存器惯例 - Linux Syscall

### 系统调用号

%rax

### 参数传递

所有的Linux 系统调用的参数都是通过通用寄存器传递的。

| 参数 | 寄存器 |
| ---- | ------ |
| 1    | %rdi   |
| 2    | %rsi   |
| 3    | %rdx   |
| 4    | %r10   |
| 5    | %r8    |
| 6    | %r9    |

### 返回地址

%rax
